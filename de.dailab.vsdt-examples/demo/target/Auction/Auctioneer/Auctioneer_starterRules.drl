package foo; // TODO package declaration

# Standard imports
import java.io.Serializable;
import de.dailab.jiactng.agentcore.action.Action;
import de.dailab.jiactng.agentcore.action.DoAction;
import de.dailab.jiactng.agentcore.comm.message.IJiacMessage;
import de.dailab.jiactng.ruleengine.timer.TimeFact;

# Domain imports
import de.dailab.jiactng.examples.auction.onto.Auction;
import de.dailab.jiactng.examples.auction.onto.Bid;
import de.dailab.jiactng.examples.auction.onto.Message;

rule "CreateAuction_Auctioneer_createauction"
when
	Action( name == "CreateAuction_Auctioneer_createauction")
	jiacMessage : IJiacMessage()
	eval("auctioneer_auctionmessage".equals(jiacMessage.getHeader(IJiacMessage.Header.SEND_TO)))
	auctionDesc : Auction() from jiacMessage.payload
then
	System.out.println("RULE CreateAuction_Auctioneer_createauction");
	insert( new DoAction(action, null, new Serializable[] { auctionDesc }) );
	retract( jiacMessage);
end

rule "PlaceBid_Auctioneer_receivebid"
when
	Action( name == "PlaceBid_Auctioneer_receivebid")
	jiacMessage : IJiacMessage()
	eval("auctioneer_bidmessage".equals(jiacMessage.getHeader(IJiacMessage.Header.SEND_TO)))
	bidDesc : Bid() from jiacMessage.payload
then
	System.out.println("RULE PlaceBid_Auctioneer_receivebid");
	insert( new DoAction(action, null, new Serializable[] { bidDesc }) );
	retract( jiacMessage);
end

rule "CloseAuction_Auctioneer_auctionover"
when
	Action( name == "CloseAuction_Auctioneer_auctionover")
	currentTime : TimeFact()
theAuction : Auction( completed == false, endingTime < currentTime.time )
then
	System.out.println("RULE CloseAuction_Auctioneer_auctionover");
	insert( new DoAction(action, null, new Serializable[] { theAuction }) );
end

